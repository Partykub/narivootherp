# Use Case Document – ระบบข้อมูลการศึกษา (School ERP)

> อ้างอิงจาก PRD.md และ SRS.md  
> Actors หลัก: นักเรียน, ผู้ปกครอง, อาจารย์ผู้สอน, ครูประจำชั้น, หัวหน้ากลุ่ม/ฝ่ายวิชาการ, เจ้าหน้าที่การเงิน, เจ้าหน้าที่เอกสาร, ผู้ดูแลระบบ

---

## UC-01 ดูข้อมูลนักเรียนและตารางเรียน
- **Actor หลัก**: นักเรียน (Student)  
- **เป้าหมาย**: ตรวจสอบข้อมูลส่วนตัว ตารางเรียน/สอบ และเอกสารที่เกี่ยวข้อง  
- **Preconditions**: นักเรียนเข้าสู่ระบบสำเร็จ และมีสิทธิ์ดูข้อมูลตนเอง  
- **Main Flow**:  
  1. นักเรียนเข้าสู่เมนู “ข้อมูลของฉัน”  
  2. ระบบดึงข้อมูลโปรไฟล์ ตารางเรียน และเอกสารล่าสุด  
  3. นักเรียนเลือกดูรายละเอียด เช่น วิชารายวัน หรือดาวน์โหลดเอกสาร  
  4. ระบบบันทึกการเข้าถึงใน audit log  
- **Alternative Flows**:  
  - 3a. หากไม่มีเอกสารสำหรับดาวน์โหลด ระบบแสดงข้อความแจ้ง  
  - 3b. หากตารางยังไม่ประกาศ ระบบแสดงสถานะ “รอประกาศ”  
- **Postconditions**: นักเรียนได้รับข้อมูลล่าสุด และระบบเก็บประวัติการเข้าดู

## UC-02 ครูบันทึกคะแนนและเสนอเกรด
- **Actor หลัก**: อาจารย์ผู้สอน  
- **เป้าหมาย**: กรอกคะแนนย่อยและเสนอเกรดให้หัวหน้ากลุ่มอนุมัติ  
- **Preconditions**: ครูได้รับมอบหมายวิชา และมีองค์ประกอบคะแนนที่ถูกตั้งค่าแล้ว  
- **Main Flow**:  
  1. ครูเปิดเมนูวิชาที่รับผิดชอบ → เลือก assessment  
  2. กรอกคะแนนทีละคนหรืออัปโหลดไฟล์ CSV  
  3. ระบบตรวจสอบ validation (น้ำหนักครบ, คะแนนอยู่ในช่วง)  
  4. ครูตรวจผลรวมและกด “Submit for Approval”  
  5. ระบบเปลี่ยนสถานะเป็น “Submitted” และแจ้งเตือนหัวหน้ากลุ่ม  
- **Alternative Flows**:  
  - 2a. หากไฟล์ CSV ไม่ผ่านรูปแบบ ระบบแจ้งข้อผิดพลาด  
  - 3a. หากน้ำหนักรวมไม่ครบ 100% ระบบป้องกันการส่ง  
- **Postconditions**: คะแนนถูกบันทึกและรอการอนุมัติจากหัวหน้ากลุ่ม

## UC-03 อนุมัติเกรดและล็อกภาคเรียน
- **Actor หลัก**: หัวหน้ากลุ่ม/ฝ่ายวิชาการ  
- **เป้าหมาย**: พิจารณาและอนุมัติเกรดก่อนระบบล็อกคะแนน  
- **Preconditions**: เกรดถูกส่งสถานะ “Submitted” และภาคเรียนยังไม่ปิด  
- **Main Flow**:  
  1. หัวหน้ากลุ่มเปิดรายการเกรดที่รออนุมัติ  
  2. ระบบแสดงสถิติเทียบย้อนหลังและแจ้งเตือนความผิดปกติจากกฎตรวจสอบที่กำหนดไว้  
  3. หัวหน้ากลุ่มตรวจสอบรายละเอียด และเลือก “Approve” หรือ “Request Change”  
  4. เมื่ออนุมัติ ระบบเปลี่ยนสถานะเป็น “Approved”  
  5. เมื่อถึงกำหนดปิดภาคเรียน ผู้ดูแลระบบล็อกคะแนน → สถานะ “Locked”  
- **Alternative Flows**:  
  - 3a. เลือก “Request Change” → ระบบแจ้งครูพร้อมเหตุผล → เกรดกลับไปสถานะ Draft  
  - 5a. หากหลังล็อกต้องแก้ไข → ใช้ขั้นตอนคำขอแก้ไขพร้อมอนุมัติพิเศษ  
- **Postconditions**: เกรดถูกอนุมัติและล็อก; audit log ถูกบันทึก

## UC-04 สร้างใบแจ้งหนี้แบบกลุ่ม
- **Actor หลัก**: เจ้าหน้าที่การเงิน  
- **เป้าหมาย**: สร้างใบแจ้งหนี้สำหรับนักเรียนตามโครงสร้างค่าใช้จ่าย  
- **Preconditions**: มีการตั้งค่า fee structure และเลือกเทอม/กลุ่มเป้าหมายแล้ว  
- **Main Flow**:  
  1. เจ้าหน้าที่เลือกฟังก์ชัน “Bulk Invoice Generation”  
  2. กำหนดเงื่อนไข (เทอม, ระดับชั้น, โปรแกรม ฯลฯ)  
  3. ระบบคำนวณยอดตามกฎ → preview รายชื่อนักเรียนและยอดเรียกเก็บ  
  4. เจ้าหน้าที่ตรวจสอบและยืนยันการสร้าง  
  5. ระบบสร้างใบแจ้งหนี้, ออกหมายเลข, บันทึกสถานะ “Issued” และแจ้งเตือนผู้เกี่ยวข้อง  
- **Alternative Flows**:  
  - 3a. หากนักเรียนบางคนมีทุน/ส่วนลด ระบบแสดงยอดปรับปรุงให้ตรวจสอบ  
  - 4a. หากข้อมูลไม่ครบ (เช่น ไม่พบผู้ปกครอง) ระบบแจ้งเตือนและข้าม  
- **Postconditions**: ใบแจ้งหนี้ถูกสร้างและพร้อมสำหรับการชำระ/ติดตาม

## UC-05 บันทึกการชำระเงินและออกใบเสร็จ
- **Actor หลัก**: เจ้าหน้าที่การเงิน  
- **เป้าหมาย**: บันทึกชำระเงิน (manual หรือ webhook) และออกใบเสร็จ  
- **Preconditions**: มีใบแจ้งหนี้สถานะ “Issued/Partially Paid”  
- **Main Flow**:  
  1. เจ้าหน้าที่เปิดใบแจ้งหนี้ → เลือก “Record Payment”  
  2. กรอกประเภทการชำระ จำนวนเงิน วันที่ชำระ (หรือรับ webhook)  
  3. ระบบตรวจสอบยอดคงเหลือและคำนวณยอดใหม่  
  4. ระบบสร้างใบเสร็จพร้อมหมายเลข และอัปเดตสถานะใบแจ้งหนี้  
  5. ระบบส่งใบเสร็จผ่าน Email/LINE (ถ้ากำหนด)  
- **Alternative Flows**:  
  - 2a. ชำระบางส่วน → ระบบเปลี่ยนสถานะเป็น “Partially Paid”  
  - 2b. ชำระเกิน → ระบบแจ้งให้สร้าง credit note หรือคืนเงิน  
- **Postconditions**: ยอดเงินและสถานะใบแจ้งหนี้อัปเดต; ใบเสร็จถูกบันทึก

## UC-06 ออกเอกสารทางการศึกษา (ปพ./ใบรับรอง)
- **Actor หลัก**: เจ้าหน้าที่เอกสาร  
- **เป้าหมาย**: ออกเอกสารทางการศึกษาตามเทมเพลต พร้อมลายเซ็นและ QR  
- **Preconditions**: มีเทมเพลตที่อนุมัติแล้ว และนักเรียนผ่านเงื่อนไข (ไม่มีหนี้ค้าง ฯลฯ)  
- **Main Flow**:  
  1. เจ้าหน้าที่เลือกนักเรียนและประเภทเอกสาร  
  2. ระบบดึงข้อมูลที่จำเป็นและแสดง preview  
  3. เจ้าหน้าที่ตรวจสอบ → กด “Submit for Approval” (ถ้ามีหลายขั้น)  
  4. ผู้มีสิทธิ์อนุมัติ → ระบบตรวจสอบเงื่อนไขตามกฎธุรกิจ → ออกเลขที่เอกสาร, ลายเซ็นดิจิทัล, QR verification  
  5. ระบบบันทึกเอกสารและเปิดให้นักเรียนดาวน์โหลด  
- **Alternative Flows**:  
  - 2a. หากข้อมูลไม่ครบ ระบบแจ้งรายการที่ต้องแก้ไข  
  - 4a. หากไม่ผ่านอนุมัติ → เอกสารกลับไปแก้ไข พร้อมระบุเหตุผล  
- **Postconditions**: เอกสารได้รับการออกอย่างเป็นทางการและบันทึก audit log

## UC-07 ประเมินคุณลักษณะและบันทึกเหตุการณ์
- **Actor หลัก**: ครูประจำชั้น/ที่ปรึกษา  
- **เป้าหมาย**: บันทึกผลการประเมินรายห้องและเหตุการณ์พฤติกรรม  
- **Preconditions**: กำหนด rubric หรือประเภทเหตุการณ์ล่วงหน้า  
- **Main Flow**:  
  1. ครูเลือกนักเรียน/ห้อง → เลือกแบบประเมินหรือ incident  
  2. กรอกผล/รายละเอียดเหตุการณ์  
  3. ระบบบันทึกคะแนน/รายละเอียดและ trigger การแจ้งเตือน (ถ้าตั้งค่า)  
  4. ข้อมูลถูกบันทึกในรายงานและพร้อมสำหรับการสรุปผล  
- **Alternative Flows**:  
  - 2a. ระบุว่าต้องแจ้งผู้ปกครอง → ระบบส่งแจ้งเตือน  
- **Postconditions**: ข้อมูลประเมินและเหตุการณ์ถูกเก็บและเรียกดูได้

## UC-08 จัดการสิทธิ์และบทบาท
- **Actor หลัก**: ผู้ดูแลระบบ  
- **เป้าหมาย**: สร้าง/แก้ไขบทบาท กำหนด permission และมอบหมายให้ผู้ใช้  
- **Preconditions**: ผู้ดูแลมีสิทธิ์ ADMIN_USER_MGMT  
- **Main Flow**:  
  1. ผู้ดูแลเข้าเมนู Role & Permission  
  2. สร้างหรือแก้ไขบทบาท พร้อมรายการ permission codes  
  3. มอบหมายบทบาทให้ผู้ใช้หรือกลุ่มผู้ใช้  
  4. ระบบบันทึกการเปลี่ยนแปลงและแจ้งเตือน (ถ้าจำเป็น)  
- **Alternative Flows**:  
  - 2a. หาก permission ทับซ้อน → ระบบเตือนและให้ยืนยัน  
  - 3a. หากผู้ใช้ถูกระงับ → ระบบไม่อนุญาตมอบหมาย  
- **Postconditions**: ค่า RBAC ถูกอัปเดตและบันทึกใน audit log

## UC-09 ดูรายงานและตั้งการแจ้งเตือน
- **Actor หลัก**: ผู้บริหาร/เจ้าหน้าที่ที่ได้รับสิทธิ์  
- **เป้าหมาย**: ตรวจรายงานหลักและกำหนดเงื่อนไขแจ้งเตือน  
- **Preconditions**: ผู้ใช้มีสิทธิ์ในโมดูล Reports/Notifications  
- **Main Flow**:  
  1. ผู้ใช้เลือกเมนูรายงาน (ผลการเรียน, การเงิน, เอกสาร)  
  2. กำหนดช่วงเวลา/ตัวกรอง → ระบบแสดงรายงานพร้อมกราฟ/ตาราง  
  3. ผู้ใช้สามารถ export หรือบันทึกเป็น preset  
  4. ตั้งค่า trigger แจ้งเตือน (เช่น invoice overdue 7 วัน)  
  5. ระบบบันทึกเงื่อนไขและเริ่มตรวจตามกำหนด  
- **Alternative Flows**:  
  - 2a. หากไม่มีข้อมูลตามเงื่อนไข → ระบบแสดงข้อความ “ไม่พบข้อมูล”  
- **Postconditions**: รายงานถูกแสดง/ส่งออก และเงื่อนไขแจ้งเตือนถูกตั้งค่า

## UC-10 จัดการคำขอแก้ไขคะแนนหลังปิดภาคเรียน
- **Actor หลัก**: อาจารย์ผู้สอน (ร้องขอ) และหัวหน้ากลุ่ม/ผู้อนุมัติ  
- **เป้าหมาย**: เปลี่ยนคะแนนหลังสถานะ locked โดยมีการอนุมัติและ audit  
- **Preconditions**: ภาคเรียนถูกล็อก และมีเหตุผลรองรับการแก้ไข  
- **Main Flow**:  
  1. ครูเลือกนักเรียน/วิชา → กด “Request Grade Change” พร้อมเหตุผล  
  2. ระบบสร้างคำขอ ส่งให้หัวหน้ากลุ่ม/ผู้มีสิทธิ์  
  3. ผู้อนุมัติพิจารณา → อนุมัติหรือปฏิเสธ  
  4. หากอนุมัติ ระบบเปิดให้แก้ไขคะแนน → ครูปรับค่า → ระบบคำนวณใหม่  
  5. ระบบล็อกอีกครั้งและบันทึก audit log (ก่อน/หลัง)  
- **Alternative Flows**:  
  - 3a. หากปฏิเสธ → ระบบแจ้งผลพร้อมเหตุผล และคงคะแนนเดิม  
- **Postconditions**: คะแนนถูกอัปเดต (ถ้าอนุมัติ) พร้อมร่องรอยการเปลี่ยนแปลง

---

เอกสารนี้ใช้เป็นฐานสำหรับการออกแบบ wireframe, flow diagram, test case และการประมาณ effort ในแต่ละ use case โดยสอดคล้องกับข้อกำหนดใน PRD และ SRS
